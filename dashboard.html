<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Plex Preroll Manager</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #e2e8f0;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .github-link {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #94a3b8;
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: color 0.3s ease;
        }

        .github-link:hover {
            color: #f1f5f9;
        }
        .header h1 {
            color: #f1f5f9;
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        .header p {
            color: #94a3b8;
            font-size: 1.1em;
            font-weight: 400;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .status-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .status-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        .status-card h3 {
            color: #f1f5f9;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            box-shadow: 0 0 10px currentColor;
        }
        .status-connected { background-color: #10b981; color: #10b981; }
        .status-disconnected { background-color: #ef4444; color: #ef4444; }
        .categories-section, .upload-section {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .categories-section h2, .upload-section h2 {
            color: #f1f5f9;
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            letter-spacing: -0.01em;
        }
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .category-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        .category-card:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }
        .category-card.active {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }
        .category-card h4 {
            color: #f1f5f9;
            margin-bottom: 12px;
            font-size: 1.2em;
            font-weight: 600;
        }
        .category-stats {
            color: #94a3b8;
            font-size: 0.9em;
            font-weight: 500;
        }
        .btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            letter-spacing: 0.025em;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        .btn-secondary {
            background: rgba(71, 85, 105, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn-secondary:hover {
            background: rgba(100, 116, 139, 0.8);
            border-color: rgba(255, 255, 255, 0.2);
        }
        .upload-form {
            margin-top: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #f1f5f9;
            font-weight: 600;
            font-size: 0.95em;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 14px;
            background: rgba(30, 41, 59, 0.6);
            color: #f1f5f9;
            backdrop-filter: blur(10px);
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .form-group input::placeholder {
            color: #64748b;
        }
        .prerolls-list {
            margin-top: 20px;
        }
        .preroll-item {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            backdrop-filter: blur(10px);
        }
        .preroll-thumbnail {
            flex-shrink: 0;
        }
        .preroll-thumbnail img {
            width: 120px;
            height: 68px;
            object-fit: cover;
            border-radius: 6px;
            transition: transform 0.2s ease;
        }
        .preroll-thumbnail img:hover {
            transform: scale(1.05);
        }
        .no-thumbnail {
            width: 120px;
            height: 68px;
            background: rgba(59, 130, 246, 0.1);
            border: 2px dashed rgba(59, 130, 246, 0.3);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
            font-size: 12px;
            text-align: center;
        }
        .preroll-info {
            flex: 1;
        }
        .preroll-meta {
            margin-top: 8px;
        }
        .preroll-actions {
            flex-shrink: 0;
        }

        /* Upload Mode Toggle */
        .upload-mode-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .upload-mode-toggle .btn {
            flex: 1;
        }

        .upload-mode-toggle .btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }

        /* Bulk Upload Styles */
        .bulk-upload-form {
            border: 2px dashed rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 20px;
            background: rgba(59, 130, 246, 0.05);
        }

        .bulk-file-list {
            margin-top: 20px;
            padding: 15px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .bulk-file-list h4 {
            color: #f1f5f9;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            margin-bottom: 5px;
            background: rgba(51, 65, 85, 0.5);
            border-radius: 6px;
            font-size: 0.9em;
        }

        .file-name {
            color: #f1f5f9;
            flex: 1;
        }

        .file-size {
            color: #94a3b8;
            font-size: 0.8em;
        }

        /* Upload Progress Styles */
        .upload-progress {
            margin-top: 20px;
            padding: 20px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progress-header {
            margin-bottom: 15px;
        }

        .progress-header h4 {
            color: #f1f5f9;
            margin-bottom: 10px;
        }

        .overall-progress {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(51, 65, 85, 0.5);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #3b82f6 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            color: #f1f5f9;
            font-weight: 600;
            min-width: 45px;
            text-align: right;
        }

        .individual-progress {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .file-progress-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: rgba(51, 65, 85, 0.3);
            border-radius: 6px;
        }

        .file-progress-name {
            flex: 1;
            color: #f1f5f9;
            font-size: 0.9em;
        }

        .file-progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(51, 65, 85, 0.5);
            border-radius: 3px;
            overflow: hidden;
        }

        .file-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #3b82f6 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .file-progress-status {
            color: #94a3b8;
            font-size: 0.8em;
            min-width: 60px;
            text-align: right;
        }

        .upload-complete {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .upload-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        .preroll-info h5 {
            color: #f1f5f9;
            margin-bottom: 6px;
            font-weight: 600;
        }
        .preroll-info small {
            color: #94a3b8;
            font-size: 0.85em;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
            font-style: italic;
        }
        .error {
            background: rgba(239, 68, 68, 0.1);
            color: #fca5a5;
            padding: 16px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        .success {
            background: rgba(16, 185, 129, 0.1);
            color: #86efac;
            padding: 16px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        .schedules-section {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .schedules-section h2 {
            color: #f1f5f9;
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            letter-spacing: -0.01em;
        }

        /* Backup/Restore Styles */
        .backup-section {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .backup-section h2 {
            color: #f1f5f9;
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            letter-spacing: -0.01em;
        }
        .backup-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .backup-list {
            margin-top: 20px;
        }
        .backup-item {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        .backup-info h4 {
            color: #f1f5f9;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .backup-info small {
            color: #94a3b8;
            font-size: 0.85em;
        }
        .backup-actions {
            display: flex;
            gap: 8px;
        }

        /* Update Notification Styles */
        .update-notification {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin: 20px 0;
            display: none;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 100;
        }
        .update-notification h3 {
            margin: 0 0 8px 0;
            font-size: 1.1em;
            font-weight: 600;
        }
        .update-notification p {
            margin: 0 0 15px 0;
            font-size: 0.9em;
            opacity: 0.9;
        }
        .update-actions {
            display: flex;
            gap: 10px;
        }
        .update-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .update-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        .update-dismiss {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .update-dismiss:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .schedules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .schedule-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        .schedule-card:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }
        .schedule-card.active {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }
        .schedule-card.inactive {
            opacity: 0.8;
            border-color: #6b7280;
            background: rgba(107, 114, 128, 0.1);
            position: relative;
        }
        .schedule-card.inactive::before {
            content: "INACTIVE";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #6b7280;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }
        .schedule-card h4 {
            color: #f1f5f9;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: 600;
        }
        .schedule-details {
            color: #94a3b8;
            font-size: 0.85em;
            font-weight: 500;
            margin-bottom: 15px;
        }
        .schedule-actions {
            display: flex;
            gap: 8px;
        }
        .create-schedule-section {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .create-schedule-section h2 {
            color: #f1f5f9;
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            letter-spacing: -0.01em;
        }
        .schedule-form {
            margin-top: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header { padding: 30px 20px; }
            .header h1 { font-size: 2.2em; }
            .status-grid { grid-template-columns: 1fr; }
            .categories-grid { grid-template-columns: 1fr; }
            .schedules-grid { grid-template-columns: 1fr; }
            .categories-section, .upload-section, .schedules-section, .create-schedule-section { padding: 20px; }
            .form-row { grid-template-columns: 1fr; }
        }

        /* Statistics Section */
        .statistics-section {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .statistics-section h2 {
            color: #f1f5f9;
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            letter-spacing: -0.01em;
        }

        /* Statistics Controls */
        .stats-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        .stats-controls select {
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(30, 41, 59, 0.6);
            color: #f1f5f9;
            font-size: 14px;
        }

        /* Statistics Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stats-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }

        .stats-card h3 {
            color: #94a3b8;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            color: #f1f5f9;
            font-size: 2em;
            font-weight: 700;
            margin: 0;
        }

        /* Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .chart-card h3 {
            color: #f1f5f9;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .chart-card canvas {
            max-height: 300px;
        }

        /* Top Prerolls Table */
        .top-prerolls-section h3 {
            color: #f1f5f9;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: 600;
        }

        .top-prerolls-table table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .top-prerolls-table th,
        .top-prerolls-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .top-prerolls-table th {
            background: rgba(51, 65, 85, 0.5);
            color: #f1f5f9;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .top-prerolls-table td {
            color: #e2e8f0;
            font-size: 0.9em;
        }

        .top-prerolls-table tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        /* Update responsive design to include statistics */
        .categories-section, .upload-section, .schedules-section, .create-schedule-section, .statistics-section { padding: 20px; }
        .stats-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
        .charts-container { grid-template-columns: 1fr; }
        .stats-controls { flex-direction: column; align-items: stretch; }
        .top-prerolls-table { overflow-x: auto; }
    </style>
</head>
<body>
    <div class='container'>
        <div class='header'>
            <h1>Plex Preroll Manager</h1>
            <p>Manage your Plex cinema prerolls with ease</p>
            <a href='https://github.com/JFLXCLOUD/PlexPrerollManager' target='_blank' class='github-link'>
                <svg width='16' height='16' viewBox='0 0 16 16' fill='currentColor'>
                    <path d='M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z'/>
                </svg>
                GitHub
            </a>
        </div>

        <!-- Update Notification (moved to top) -->
        <div class='update-notification' id='updateNotification'>
            <h3>🔄 Update Available!</h3>
            <p id='updateMessage'>A new version of PlexPrerollManager is available.</p>
            <div class='update-actions'>
                <button class='update-btn' id='updateDownloadBtn'>Download Update</button>
                <button class='update-btn update-dismiss' id='updateDismissBtn'>Dismiss</button>
            </div>
        </div>

        <div class='status-grid'>
            <div class='status-card'>
                <h3><span class='status-indicator' id='plexStatus'></span>Plex Server</h3>
                <div id='plexInfo'>Loading...</div>
            </div>
            <div class='status-card'>
                <h3>Statistics</h3>
                <div id='statsInfo'>Loading...</div>
            </div>
            <div class='status-card'>
                <h3>Active Category</h3>
                <div id='activeCategory'>Loading...</div>
            </div>
        </div>

        <div class='categories-section'>
            <h2>Categories</h2>
            <div class='categories-grid' id='categoriesGrid'>
                <div class='loading'>Loading categories...</div>
            </div>
        </div>

        <div class='prerolls-list' id='prerollsSection' style='display: none;'>
            <h2>Prerolls in <span id='currentCategory'></span></h2>
            <div id='prerollsGrid'>
                <div class='loading'>Loading prerolls...</div>
            </div>
        </div>

        <div class='upload-section'>
            <h2>Upload New Preroll</h2>

            <!-- Upload Mode Toggle -->
            <div class='upload-mode-toggle'>
                <button type='button' class='btn btn-secondary' id='singleUploadBtn' onclick='setUploadMode("single")'>Single Upload</button>
                <button type='button' class='btn' id='bulkUploadBtn' onclick='setUploadMode("bulk")'>Bulk Upload</button>
            </div>

            <!-- Single Upload Form -->
            <form class='upload-form' id='singleUploadForm' enctype='multipart/form-data'>
                <div class='form-group'>
                    <label for='videoFile'>Video File:</label>
                    <input type='file' id='videoFile' name='file' accept='video/*' required>
                </div>
                <div class='form-group'>
                    <label for='category'>Category:</label>
                    <input type='text' id='category' name='category' list='categoryList' placeholder='Select or type new category' required>
                    <datalist id='categoryList'>
                        <!-- Categories will be populated dynamically -->
                    </datalist>
                </div>
                <div class='form-group'>
                    <label for='videoName'>Video Name:</label>
                    <input type='text' id='videoName' name='name' placeholder='Enter video name' required>
                </div>
                <button type='submit' class='btn'>Upload Video</button>
            </form>

            <!-- Bulk Upload Form -->
            <form class='upload-form bulk-upload-form' id='bulkUploadForm' enctype='multipart/form-data' style='display: none;'>
                <div class='form-group'>
                    <label for='bulkVideoFiles'>Video Files (Multiple):</label>
                    <input type='file' id='bulkVideoFiles' name='files' accept='video/*' multiple required>
                    <small style='color: #94a3b8; margin-top: 5px; display: block;'>Select multiple video files to upload to the same category</small>
                </div>
                <div class='form-group'>
                    <label for='bulkCategory'>Category (All files):</label>
                    <input type='text' id='bulkCategory' name='category' list='bulkCategoryList' placeholder='Select or type new category' required>
                    <datalist id='bulkCategoryList'>
                        <!-- Categories will be populated dynamically -->
                    </datalist>
                </div>
                <div class='bulk-file-list' id='bulkFileList' style='display: none;'>
                    <h4>Files to Upload:</h4>
                    <div id='fileListContainer'></div>
                </div>
                <button type='submit' class='btn'>Upload All Files</button>
            </form>

            <!-- Upload Progress -->
            <div class='upload-progress' id='uploadProgress' style='display: none;'>
                <div class='progress-header'>
                    <h4 id='progressTitle'>Uploading...</h4>
                    <div class='overall-progress'>
                        <div class='progress-bar'>
                            <div class='progress-fill' id='overallProgressFill'></div>
                        </div>
                        <span class='progress-text' id='overallProgressText'>0%</span>
                    </div>
                </div>
                <div class='individual-progress' id='individualProgress'></div>
            </div>
        </div>

        <div class='create-schedule-section'>
            <h2>⏰ Quick Schedule</h2>
            <form class='schedule-form' id='createScheduleForm'>
                <div class='form-row'>
                    <div class='form-group'>
                        <label for='scheduleName'>Schedule Name:</label>
                        <input type='text' id='scheduleName' name='name' placeholder='e.g., Halloween Schedule' required>
                    </div>
                    <div class='form-group'>
                        <label for='scheduleCategory'>Category:</label>
                        <select id='scheduleCategory' name='category' required>
                            <option value=''>Select Category</option>
                        </select>
                    </div>
                </div>
                <div class='form-row'>
                    <div class='form-group'>
                        <label for='scheduleType'>Schedule Type:</label>
                        <select id='scheduleType' name='type' required>
                            <option value='OneTime'>One Time</option>
                            <option value='Daily'>Daily</option>
                            <option value='Weekly'>Weekly</option>
                            <option value='Monthly'>Monthly</option>
                            <option value='Yearly'>Yearly</option>
                        </select>
                    </div>
                    <div class='form-group'>
                        <label for='startDate'>Start Date & Time:</label>
                        <input type='datetime-local' id='startDate' name='startDate' required>
                    </div>
                </div>
                <div class='form-row'>
                    <div class='form-group'>
                        <label for='endDate'>End Date & Time (Optional):</label>
                        <input type='datetime-local' id='endDate' name='endDate'>
                    </div>
                    <div class='form-group'>
                        <label for='isActive'>Active:</label>
                        <select id='isActive' name='isActive'>
                            <option value='true'>Yes</option>
                            <option value='false'>No</option>
                        </select>
                    </div>
                </div>
                <button type='submit' class='btn'>Create Schedule</button>
                <a href='/scheduling' class='btn btn-secondary' style='text-decoration: none; display: inline-block;'>Advanced Scheduling</a>
            </form>
        </div>

        <div class='schedules-section'>
            <h2>📋 Active Schedules</h2>
            <div class='schedules-grid' id='schedulesGrid'>
                <div class='loading'>Loading schedules...</div>
            </div>
        </div>

        <!-- Usage Statistics Section -->
        <div class='statistics-section'>
            <h2>📊 Usage Statistics</h2>

            <!-- Statistics Controls -->
            <div class='stats-controls'>
                <select id='statsPeriod'>
                    <option value='daily'>Daily</option>
                    <option value='weekly'>Weekly</option>
                    <option value='monthly'>Monthly</option>
                </select>
                <select id='statsDays'>
                    <option value='7'>Last 7 days</option>
                    <option value='30'>Last 30 days</option>
                    <option value='90'>Last 90 days</option>
                </select>
                <button class='btn' onclick='refreshStats()'>Refresh</button>
            </div>

            <!-- Statistics Cards -->
            <div class='stats-grid' id='statsGrid'>
                <div class='stats-card'>
                    <h3>Total Plays</h3>
                    <div class='stat-value' id='totalPlays'>0</div>
                </div>
                <div class='stats-card'>
                    <h3>Total Watch Time</h3>
                    <div class='stat-value' id='totalWatchTime'>0h 0m</div>
                </div>
                <div class='stats-card'>
                    <h3>Unique Prerolls</h3>
                    <div class='stat-value' id='uniquePrerolls'>0</div>
                </div>
                <div class='stats-card'>
                    <h3>Avg. Play Duration</h3>
                    <div class='stat-value' id='avgDuration'>0s</div>
                </div>
            </div>

            <!-- Charts Container -->
            <div class='charts-container'>
                <div class='chart-card'>
                    <h3>Plays Over Time</h3>
                    <canvas id='playsChart'></canvas>
                </div>
                <div class='chart-card'>
                    <h3>Top Categories</h3>
                    <canvas id='categoriesChart'></canvas>
                </div>
            </div>

            <!-- Top Prerolls Table -->
            <div class='top-prerolls-section'>
                <h3>🏆 Top Performing Prerolls</h3>
                <div class='top-prerolls-table' id='topPrerollsTable'>
                    <div class='loading'>Loading top prerolls...</div>
                </div>
            </div>
        </div>

        <!-- Backup/Restore Section -->
        <div class='backup-section'>
            <h2>💾 Backup & Restore</h2>
            <div class='backup-actions'>
                <button class='btn' id='createBackupBtn'>Create Backup</button>
                <button class='btn btn-secondary' id='refreshBackupsBtn'>Refresh List</button>
            </div>
            <div class='backup-list' id='backupList'>
                <div class='loading'>Loading backups...</div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let categories = [];
        let schedules = [];
        let currentCategory = null;

        // Load initial data
        async function loadStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();

                // Update Plex status
                const plexIndicator = document.getElementById('plexStatus');
                const plexInfo = document.getElementById('plexInfo');
                if (data.PlexConnected) {
                    plexIndicator.className = 'status-indicator status-connected';
                    plexInfo.innerHTML = `<strong>${data.PlexServerName}</strong><br>Connected`;
                } else {
                    plexIndicator.className = 'status-indicator status-disconnected';
                    plexInfo.innerHTML = 'Disconnected';
                }

                // Update stats
                document.getElementById('statsInfo').innerHTML = `Total Prerolls: <strong>${data.TotalPrerolls}</strong>`;
                document.getElementById('activeCategory').innerHTML = `<strong>${data.ActiveCategory}</strong>`;

            } catch (error) {
                console.error('Error loading status:', error);
                showError('Failed to load status information');
            }
        }

        async function loadCategories() {
            try {
                const response = await fetch('/api/categories');
                categories = await response.json();

                const grid = document.getElementById('categoriesGrid');
                if (categories.length === 0) {
                    grid.innerHTML = '<p>No categories found. Upload some videos to get started!</p>';
                    return;
                }

                grid.innerHTML = categories.map(category => {
                    const activeClass = category.IsActive ? 'active' : '';
                    const videoText = category.PrerollCount + ' video' + (category.PrerollCount !== 1 ? 's' : '');
                    const statusText = category.IsActive ? '✅ Active' : 'Inactive';
                    const activateButton = category.IsActive ? '' :
                        `<button class='btn btn-secondary' onclick='event.stopPropagation(); activateCategory("${category.Name}")'>Activate</button>`;

                    return `<div class='category-card ${activeClass}' onclick='selectCategory("${category.Name}")'>
                        <h4>${category.Name}</h4>
                        <div class='category-stats'>
                            ${videoText}<br>
                            ${statusText}
                        </div>
                        ${activateButton}
                    </div>`;
                }).join('');

                updateScheduleCategoryDropdown();
                updateUploadCategoryDropdown();

            } catch (error) {
                console.error('Error loading categories:', error);
                document.getElementById('categoriesGrid').innerHTML = '<div class="error">Failed to load categories</div>';
            }
        }

        async function loadSchedules() {
            try {
                const response = await fetch('/api/schedules');
                schedules = await response.json();

                const grid = document.getElementById('schedulesGrid');
                if (schedules.length === 0) {
                    grid.innerHTML = '<p>No schedules found. Create your first schedule above!</p>';
                    return;
                }

                grid.innerHTML = schedules.map(schedule => {
                    const startDate = new Date(schedule.StartDate);
                    const endDate = schedule.EndDate ? new Date(schedule.EndDate) : null;
                    const lastExecuted = schedule.LastExecuted ? new Date(schedule.LastExecuted) : null;

                    return `<div class='schedule-card ${schedule.IsActive ? 'active' : 'inactive'}'>
                        <h4>${schedule.Description}</h4>
                        <div class='schedule-details'>
                            <strong>Category:</strong> ${schedule.CategoryName}<br>
                            <strong>Type:</strong> ${schedule.Type}<br>
                            <strong>Start:</strong> ${startDate.toLocaleString()}<br>` +
                            (endDate ? `<strong>End:</strong> ${endDate.toLocaleString()}<br>` : '') +
                            (lastExecuted ? `<strong>Last Executed:</strong> ${lastExecuted.toLocaleString()}<br>` : '') +
                            `<strong>Status:</strong> ${schedule.IsActive ? 'Active' : 'Inactive'}
                        </div>
                        <div class='schedule-actions'>
                            <button class='btn btn-secondary' onclick='editSchedule("${schedule.Id}")'>Edit</button>
                            <button class='btn btn-danger' onclick='deleteSchedule("${schedule.Id}")'>Delete</button>
                        </div>
                    </div>`;
                }).join('');

            } catch (error) {
                console.error('Error loading schedules:', error);
                document.getElementById('schedulesGrid').innerHTML = '<div class="error">Failed to load schedules</div>';
            }
        }

        function updateScheduleCategoryDropdown() {
            const categoryOptions = categories.map(cat =>
                `<option value="${cat.Name}">${cat.Name}</option>`
            ).join('');

            document.getElementById('scheduleCategory').innerHTML = '<option value="">Select Category</option>' + categoryOptions;
        }

        function updateUploadCategoryDropdown() {
            const categoryOptions = categories.map(cat =>
                `<option value="${cat.Name}">`
            ).join('');

            document.getElementById('categoryList').innerHTML = categoryOptions;
        }

        function selectCategory(categoryName) {
            currentCategory = categoryName;
            document.getElementById('currentCategory').textContent = categoryName;
            document.getElementById('prerollsSection').style.display = 'block';

            // Load prerolls for this category
            loadPrerollsByCategory(categoryName);
        }

        async function loadPrerollsByCategory(categoryName) {
            try {
                const response = await fetch(`/api/prerolls/${categoryName}`);
                const prerolls = await response.json();

                const grid = document.getElementById('prerollsGrid');
                if (prerolls.length === 0) {
                    grid.innerHTML = '<p>No prerolls in this category yet.</p>';
                    return;
                }

                grid.innerHTML = prerolls.map(preroll => `
                    <div class='preroll-item'>
                        <div class='preroll-thumbnail'>
                            ${preroll.ThumbnailPath ?
                                `<img src='${preroll.ThumbnailPath}' alt='${preroll.Name}' onclick='previewVideo("${preroll.FilePath}")' style='cursor: pointer;'>` :
                                `<div class='no-thumbnail'>🎬<br>No Preview</div>`
                            }
                        </div>
                        <div class='preroll-info'>
                            <h5>${preroll.Name}</h5>
                            <div class='preroll-meta'>
                                ${preroll.HasMetadata ? `
                                    <small>
                                        ${preroll.Duration ? `Duration: ${formatDuration(preroll.Duration)} | ` : ''}
                                        ${preroll.Resolution ? `Resolution: ${preroll.Resolution} | ` : ''}
                                        Size: ${(preroll.FileSizeBytes / 1024 / 1024).toFixed(1)} MB<br>
                                        ${preroll.VideoCodec ? `Video: ${preroll.VideoCodec}` : ''}
                                        ${preroll.AudioCodec ? ` | Audio: ${preroll.AudioCodec}` : ''}
                                    </small>
                                ` : `
                                    <small>Size: ${(preroll.FileSizeBytes / 1024 / 1024).toFixed(1)} MB | Added: ${new Date(preroll.CreatedDate).toLocaleDateString()}</small>
                                `}
                            </div>
                        </div>
                        <div class='preroll-actions'>
                            <button class='btn btn-secondary' onclick='deletePreroll("${preroll.Id}")'>Delete</button>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error loading prerolls:', error);
                document.getElementById('prerollsGrid').innerHTML = '<div class="error">Failed to load prerolls</div>';
            }
        }

        async function activateCategory(categoryName) {
            try {
                const response = await fetch(`/api/categories/${categoryName}/activate`, {
                    method: 'POST'
                });

                if (response.ok) {
                    showSuccess(`Category '${categoryName}' activated successfully!`);
                    loadStatus();
                    loadCategories();
                } else {
                    showError('Failed to activate category');
                }
            } catch (error) {
                console.error('Error activating category:', error);
                showError('Failed to activate category');
            }
        }

        async function deletePreroll(prerollId) {
            if (!confirm('Are you sure you want to delete this preroll?')) return;

            try {
                const response = await fetch(`/api/prerolls/${prerollId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showSuccess('Preroll deleted successfully!');
                    if (currentCategory) {
                        loadPrerollsByCategory(currentCategory);
                    }
                    loadCategories();
                } else {
                    showError('Failed to delete preroll');
                }
            } catch (error) {
                console.error('Error deleting preroll:', error);
                showError('Failed to delete preroll');
            }
        }

        // Schedule functions
        document.getElementById('createScheduleForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const scheduleData = {
                CategoryName: formData.get('category'),
                StartDate: new Date(formData.get('startDate')).toISOString(),
                EndDate: formData.get('endDate') ? new Date(formData.get('endDate')).toISOString() : null,
                Type: formData.get('type'),
                IsActive: formData.get('isActive') === 'true',
                Description: formData.get('name')
            };

            try {
                const response = await fetch('/api/schedules', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(scheduleData)
                });

                if (response.ok) {
                    showSuccess('Schedule created successfully!');
                    document.getElementById('createScheduleForm').reset();
                    loadSchedules();
                } else {
                    const error = await response.text();
                    showError(`Failed to create schedule: ${error}`);
                }
            } catch (error) {
                console.error('Error creating schedule:', error);
                showError('Failed to create schedule');
            }
        });

        async function editSchedule(scheduleId) {
            // For simplicity, redirect to the advanced scheduling page
            window.location.href = `/scheduling`;
        }

        async function deleteSchedule(scheduleId) {
            const schedule = schedules.find(s => s.Id === scheduleId);
            if (!confirm(`Are you sure you want to delete the schedule "${schedule?.Description}"?`)) return;

            try {
                const response = await fetch(`/api/schedules/${scheduleId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showSuccess('Schedule deleted successfully!');
                    loadSchedules();
                } else {
                    showError('Failed to delete schedule');
                }
            } catch (error) {
                console.error('Error deleting schedule:', error);
                showError('Failed to delete schedule');
            }
        }

        // Global variables for upload tracking
        let currentUploadMode = 'single';
        let uploadController = null;

        // Upload mode switching
        function setUploadMode(mode) {
            currentUploadMode = mode;

            const singleBtn = document.getElementById('singleUploadBtn');
            const bulkBtn = document.getElementById('bulkUploadBtn');
            const singleForm = document.getElementById('singleUploadForm');
            const bulkForm = document.getElementById('bulkUploadForm');

            if (mode === 'single') {
                singleBtn.classList.add('active');
                bulkBtn.classList.remove('active');
                singleForm.style.display = 'block';
                bulkForm.style.display = 'none';
            } else {
                bulkBtn.classList.add('active');
                singleBtn.classList.remove('active');
                bulkForm.style.display = 'block';
                singleForm.style.display = 'none';
            }
        }

        // Bulk file selection handler
        document.getElementById('bulkVideoFiles').addEventListener('change', (e) => {
            const files = e.target.files;
            const fileListContainer = document.getElementById('fileListContainer');
            const bulkFileList = document.getElementById('bulkFileList');

            if (files.length > 0) {
                bulkFileList.style.display = 'block';
                fileListContainer.innerHTML = '';

                Array.from(files).forEach((file, index) => {
                    const fileSizeMB = (file.size / 1024 / 1024).toFixed(1);
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <span class='file-name'>${file.name}</span>
                        <span class='file-size'>${fileSizeMB} MB</span>
                    `;
                    fileListContainer.appendChild(fileItem);
                });
            } else {
                bulkFileList.style.display = 'none';
            }
        });

        // Single upload form handler
        document.getElementById('singleUploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await uploadFiles('single');
        });

        // Bulk upload form handler
        document.getElementById('bulkUploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await uploadFiles('bulk');
        });

        // Unified upload function
        async function uploadFiles(mode) {
            const formData = new FormData();
            let category = '';
            let files = [];

            if (mode === 'single') {
                const fileInput = document.getElementById('videoFile');
                const categoryInput = document.getElementById('category');
                const nameInput = document.getElementById('videoName');

                if (!fileInput.files[0]) {
                    showError('Please select a video file');
                    return;
                }

                files = [fileInput.files[0]];
                category = categoryInput.value;
                formData.append('file', files[0]);
                formData.append('name_0', nameInput.value || files[0].name);
            } else {
                const fileInput = document.getElementById('bulkVideoFiles');
                const categoryInput = document.getElementById('bulkCategory');

                if (fileInput.files.length === 0) {
                    showError('Please select video files');
                    return;
                }

                files = Array.from(fileInput.files);
                category = categoryInput.value;

                files.forEach((file, index) => {
                    formData.append('file', file);
                    formData.append(`name_${index}`, file.name);
                });
            }

            formData.append('category', category);

            // Show progress UI
            showUploadProgress(files);

            // Create AbortController for cancellation
            uploadController = new AbortController();

            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData,
                    signal: uploadController.signal,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const result = await response.json();

                if (result.Success || result.SuccessfulUploads > 0) {
                    const message = result.Success
                        ? `All ${result.TotalFiles} files uploaded successfully!`
                        : `${result.SuccessfulUploads} of ${result.TotalFiles} files uploaded successfully!`;
                    showSuccess(message);

                    // Reset forms
                    if (mode === 'single') {
                        document.getElementById('singleUploadForm').reset();
                    } else {
                        document.getElementById('bulkUploadForm').reset();
                        document.getElementById('bulkFileList').style.display = 'none';
                    }

                    // Refresh data
                    loadCategories();
                    if (currentCategory === category) {
                        loadPrerollsByCategory(currentCategory);
                    }
                    updateUploadCategoryDropdown();
                } else {
                    showError(result.Message || 'Upload failed');
                }
            } catch (error) {
                console.error('Error uploading files:', error);

                if (error.name === 'AbortError') {
                    showError('Upload was cancelled');
                } else if (error.message.includes('Failed to fetch')) {
                    showError('Network error - please check your connection and try again');
                } else {
                    showError(`Upload failed: ${error.message}`);
                }
            } finally {
                hideUploadProgress();
                uploadController = null;
            }
        }

        // Progress UI functions
        function showUploadProgress(files) {
            const progressDiv = document.getElementById('uploadProgress');
            const progressTitle = document.getElementById('progressTitle');
            const individualProgress = document.getElementById('individualProgress');

            progressTitle.textContent = `Uploading ${files.length} file${files.length > 1 ? 's' : ''}...`;
            progressDiv.style.display = 'block';

            // Create individual progress bars
            individualProgress.innerHTML = '';
            files.forEach((file, index) => {
                const fileSizeMB = (file.size / 1024 / 1024).toFixed(1);
                const progressItem = document.createElement('div');
                progressItem.className = 'file-progress-item';
                progressItem.id = `file-progress-${index}`;
                progressItem.innerHTML = `
                    <span class='file-progress-name'>${file.name} (${fileSizeMB} MB)</span>
                    <div class='file-progress-bar'>
                        <div class='file-progress-fill' id='file-progress-fill-${index}'></div>
                    </div>
                    <span class='file-progress-status' id='file-progress-status-${index}'>Waiting...</span>
                `;
                individualProgress.appendChild(progressItem);
            });
        }

        function hideUploadProgress() {
            document.getElementById('uploadProgress').style.display = 'none';
        }

        function updateFileProgress(fileIndex, progress, status) {
            const fill = document.getElementById(`file-progress-fill-${fileIndex}`);
            const statusSpan = document.getElementById(`file-progress-status-${fileIndex}`);
            const item = document.getElementById(`file-progress-${fileIndex}`);

            if (fill) fill.style.width = `${progress}%`;
            if (statusSpan) statusSpan.textContent = status;

            if (status === 'Complete') {
                item.classList.add('upload-complete');
            } else if (status === 'Error') {
                item.classList.add('upload-error');
            }
        }

        function updateOverallProgress(progress) {
            const fill = document.getElementById('overallProgressFill');
            const text = document.getElementById('overallProgressText');

            if (fill) fill.style.width = `${progress}%`;
            if (text) text.textContent = `${Math.round(progress)}%`;
        }

        // Utility functions
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.container').firstChild);
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.querySelector('.container').insertBefore(successDiv, document.querySelector('.container').firstChild);
            setTimeout(() => successDiv.remove(), 5000);
        }

        // Video preview functionality
        function previewVideo(videoPath) {
            // Create a modal for video preview
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;

            const videoContainer = document.createElement('div');
            videoContainer.style.cssText = `
                background: #000;
                border-radius: 8px;
                padding: 20px;
                max-width: 90vw;
                max-height: 90vh;
                position: relative;
            `;

            const closeButton = document.createElement('button');
            closeButton.textContent = '✕';
            closeButton.style.cssText = `
                position: absolute;
                top: 10px;
                right: 10px;
                background: rgba(0, 0, 0, 0.7);
                color: white;
                border: none;
                border-radius: 50%;
                width: 30px;
                height: 30px;
                cursor: pointer;
                font-size: 16px;
            `;

            const video = document.createElement('video');
            video.src = videoPath;
            video.controls = true;
            video.style.cssText = `
                max-width: 100%;
                max-height: 70vh;
                border-radius: 4px;
            `;

            closeButton.onclick = () => {
                video.pause();
                document.body.removeChild(modal);
            };

            modal.onclick = (e) => {
                if (e.target === modal) {
                    video.pause();
                    document.body.removeChild(modal);
                }
            };

            videoContainer.appendChild(closeButton);
            videoContainer.appendChild(video);
            modal.appendChild(videoContainer);
            document.body.appendChild(modal);

            // Focus the video for keyboard controls
            video.focus();
        }

        // Format duration from TimeSpan
        function formatDuration(duration) {
            if (!duration) return '';

            const totalSeconds = Math.floor(duration / 10000000); // Convert ticks to seconds
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // ===== Backup/Restore Functions =====

        async function createBackup() {
            try {
                const response = await fetch('/api/backup', {
                    method: 'POST'
                });

                const result = await response.json();

                if (result.Success) {
                    showSuccess(`Backup created successfully: ${result.FilePath}`);
                    loadBackups();
                } else {
                    showError(result.Error || 'Failed to create backup');
                }
            } catch (error) {
                console.error('Error creating backup:', error);
                showError('Failed to create backup');
            }
        }

        async function loadBackups() {
            try {
                const response = await fetch('/api/backups');
                const backups = await response.json();

                const backupList = document.getElementById('backupList');

                if (backups.length === 0) {
                    backupList.innerHTML = '<p>No backups found. Create your first backup!</p>';
                    return;
                }

                backupList.innerHTML = backups.map(backup => {
                    const timestamp = new Date(backup.Timestamp);
                    const fileSizeMB = (backup.FileSize / 1024 / 1024).toFixed(2);

                    return `<div class='backup-item'>
                        <div class='backup-info'>
                            <h4>Backup ${timestamp.toLocaleString()}</h4>
                            <small>
                                Version: ${backup.Version} |
                                Categories: ${backup.CategoryCount} |
                                Videos: ${backup.TotalVideos} |
                                Size: ${fileSizeMB} MB
                            </small>
                        </div>
                        <div class='backup-actions'>
                            <button class='btn btn-secondary' onclick='restoreBackup("${backup.FilePath}")'>Restore</button>
                            <button class='btn btn-danger' onclick='deleteBackup("${backup.FilePath}")'>Delete</button>
                        </div>
                    </div>`;
                }).join('');

            } catch (error) {
                console.error('Error loading backups:', error);
                document.getElementById('backupList').innerHTML = '<div class="error">Failed to load backups</div>';
            }
        }

        async function restoreBackup(backupPath) {
            const fileName = backupPath.split('\\').pop() || backupPath.split('/').pop();
            if (!confirm(`Are you sure you want to restore from backup "${fileName}"? This will replace your current configuration.`)) {
                return;
            }

            try {
                const response = await fetch('/api/backup/restore', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ backupPath })
                });

                const result = await response.json();

                if (result.Success) {
                    showSuccess(result.Message || 'Backup restored successfully!');
                    // Refresh all data
                    loadStatus();
                    loadCategories();
                    loadSchedules();
                    loadBackups();
                } else {
                    showError(result.Error || 'Failed to restore backup');
                }
            } catch (error) {
                console.error('Error restoring backup:', error);
                showError('Failed to restore backup');
            }
        }

        async function deleteBackup(backupPath) {
            const fileName = backupPath.split('\\').pop() || backupPath.split('/').pop();
            if (!confirm(`Are you sure you want to delete backup "${fileName}"?`)) {
                return;
            }

            try {
                // For now, we'll just show a message since we don't have a delete API endpoint
                // In a real implementation, you'd add a DELETE /api/backups/{filename} endpoint
                showSuccess('Backup deletion not implemented yet. Please delete manually from the backups folder.');
                loadBackups();
            } catch (error) {
                console.error('Error deleting backup:', error);
                showError('Failed to delete backup');
            }
        }

        // ===== Usage Statistics Functions =====

        // Statistics variables
        let statsData = [];
        let statsPeriod = 'daily';
        let statsDays = 30;

        // Load usage statistics
        async function loadUsageStats() {
            try {
                const response = await fetch(`/api/usage/stats?period=${statsPeriod}&days=${statsDays}`);
                const data = await response.json();

                statsData = data.Data || [];
                updateStatsDisplay();
                updateCharts();

            } catch (error) {
                console.error('Error loading usage stats:', error);
                showError('Failed to load usage statistics');
            }
        }

        // Update statistics display
        function updateStatsDisplay() {
            const totalPlays = statsData.reduce((sum, day) => sum + (day.Plays || 0), 0);
            const totalWatchTime = statsData.reduce((sum, day) => sum + (day.TotalWatchTime || 0), 0);
            const uniquePrerolls = new Set(statsData.flatMap(day => day.UniquePrerolls || [])).size;
            const avgDuration = totalPlays > 0 ? Math.round(totalWatchTime / totalPlays) : 0;

            document.getElementById('totalPlays').textContent = totalPlays.toLocaleString();
            document.getElementById('totalWatchTime').textContent = formatDuration(totalWatchTime);
            document.getElementById('uniquePrerolls').textContent = uniquePrerolls;
            document.getElementById('avgDuration').textContent = formatDuration(avgDuration);
        }

        // Update charts (requires Chart.js)
        function updateCharts() {
            updatePlaysChart();
            updateCategoriesChart();
        }

        function updatePlaysChart() {
            const ctx = document.getElementById('playsChart').getContext('2d');

            const labels = statsData.map(day => new Date(day.Date).toLocaleDateString());
            const playsData = statsData.map(day => day.Plays || 0);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Plays',
                        data: playsData,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function updateCategoriesChart() {
            const ctx = document.getElementById('categoriesChart').getContext('2d');

            // Aggregate by category
            const categoryStats = {};
            statsData.forEach(day => {
                const category = day.CategoryName;
                if (!categoryStats[category]) {
                    categoryStats[category] = 0;
                }
                categoryStats[category] += day.Plays || 0;
            });

            const labels = Object.keys(categoryStats);
            const data = Object.values(categoryStats);

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#3b82f6', '#10b981', '#f59e0b', '#ef4444',
                            '#8b5cf6', '#06b6d4', '#84cc16', '#f97316'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // Load top prerolls
        async function loadTopPrerolls() {
            try {
                const response = await fetch(`/api/usage/top?limit=10&period=${statsPeriod}&days=${statsDays}`);
                const topPrerolls = await response.json();

                const table = document.getElementById('topPrerollsTable');
                if (topPrerolls.length === 0) {
                    table.innerHTML = '<p>No preroll usage data available yet.</p>';
                    return;
                }

                table.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Preroll</th>
                                <th>Category</th>
                                <th>Plays</th>
                                <th>Total Watch Time</th>
                                <th>Avg. Duration</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${topPrerolls.map((preroll, index) => `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${preroll.Name}</td>
                                    <td>${preroll.CategoryName}</td>
                                    <td>${preroll.Plays}</td>
                                    <td>${formatDuration(preroll.TotalWatchTime)}</td>
                                    <td>${formatDuration(Math.round(preroll.TotalWatchTime / preroll.Plays))}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

            } catch (error) {
                console.error('Error loading top prerolls:', error);
                document.getElementById('topPrerollsTable').innerHTML = '<div class="error">Failed to load top prerolls</div>';
            }
        }

        // Statistics controls
        function refreshStats() {
            statsPeriod = document.getElementById('statsPeriod').value;
            statsDays = parseInt(document.getElementById('statsDays').value);

            loadUsageStats();
            loadTopPrerolls();
        }

        // ===== Update Notification Functions =====

        async function checkForUpdates() {
            try {
                const response = await fetch('/api/updates/check');
                const updateInfo = await response.json();

                if (updateInfo.IsUpdateAvailable) {
                    showUpdateNotification(updateInfo);
                }
            } catch (error) {
                console.error('Error checking for updates:', error);
                // Don't show error for update checks - it's not critical
            }
        }

        function showUpdateNotification(updateInfo) {
            const notification = document.getElementById('updateNotification');
            const message = document.getElementById('updateMessage');
            const downloadBtn = document.getElementById('updateDownloadBtn');

            // Format the release notes properly
            let formattedNotes = '';
            if (updateInfo.ReleaseNotes) {
                // Split by common delimiters and format nicely
                const lines = updateInfo.ReleaseNotes.split(/\n|•|-/);
                const cleanLines = lines
                    .map(line => line.trim())
                    .filter(line => line.length > 0)
                    .slice(0, 3); // Show first 3 features

                if (cleanLines.length > 0) {
                    formattedNotes = '\n\n✨ New Features:\n• ' + cleanLines.join('\n• ');
                }
            }

            message.innerHTML = `Version <strong>${updateInfo.LatestVersion}</strong> is available (current: ${updateInfo.CurrentVersion}).${formattedNotes}`;

            downloadBtn.onclick = () => {
                if (updateInfo.ReleaseUrl) {
                    window.open(updateInfo.ReleaseUrl, '_blank');
                } else {
                    window.open('https://github.com/JFLXCLOUD/PlexPrerollManager/releases', '_blank');
                }
            };

            notification.style.display = 'block';

            // Add dismiss functionality
            document.getElementById('updateDismissBtn').onclick = () => {
                notification.style.display = 'none';
                // Store dismissal in localStorage to avoid showing again
                localStorage.setItem('updateDismissed', updateInfo.LatestVersion);
            };

            // Check if user already dismissed this version
            const dismissedVersion = localStorage.getItem('updateDismissed');
            if (dismissedVersion === updateInfo.LatestVersion) {
                notification.style.display = 'none';
            }
        }

        // ===== Event Listeners =====

        // Backup/Restore event listeners
        document.getElementById('createBackupBtn').addEventListener('click', createBackup);
        document.getElementById('refreshBackupsBtn').addEventListener('click', loadBackups);

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadStatus();
            loadCategories();
            loadSchedules();
            loadBackups();
            loadUsageStats();
            loadTopPrerolls();
            checkForUpdates();

            // Refresh data every 30 seconds
            setInterval(() => {
                loadStatus();
                loadCategories();
                loadSchedules();
            }, 30000);

            // Refresh statistics every 5 minutes
            setInterval(() => {
                loadUsageStats();
                loadTopPrerolls();
            }, 5 * 60 * 1000);

            // Check for updates every 4 hours
            setInterval(checkForUpdates, 4 * 60 * 60 * 1000);
        });
    </script>

    <!-- Chart.js for statistics visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>